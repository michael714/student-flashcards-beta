<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Flashcards - v1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Styles for the 3D card flip effect */
        .card-container {
            perspective: 1000px;
        }
        .card {
            width: 100%;
            height: 400px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .card-front {
            background-color: #f3f4f6; /* gray-200 */
        }
        .card-back {
            background-color: #ffffff;
            transform: rotateY(180deg);
            padding: 2rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

<div class="w-full max-w-md mx-auto">
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Student Flashcards</h1>
        <p class="text-gray-500">Version 1.0</p>
    </div>

    <!-- Controls -->
    <div class="flex justify-between items-center mb-4 bg-white p-4 rounded-lg shadow-sm">
        <label for="period-filter" class="font-medium text-gray-700">Filter by Period:</label>
        <select id="period-filter" class="p-2 border border-gray-300 rounded-lg">
            <option value="All">All Periods</option>
            <option value="1">Period 1</option>
            <option value="2">Period 2</option>
            <option value="3">Period 3</option>
            <option value="4">Period 4</option>
            <option value="6">Period 6</option>
        </select>
    </div>

    <!-- Flashcard Area -->
    <div id="flashcard-area" class="mb-4">
        <div id="no-students-message" class="text-center p-8 bg-white rounded-lg shadow-sm hidden">
            <p class="text-gray-600">No students found for this period. Try selecting another!</p>
        </div>
        <div class="card-container">
            <div id="card" class="card">
                <!-- Card Front (Photo) -->
                <div class="card-face card-front">
                    <img id="student-photo" src="" class="w-full h-full object-cover rounded-xl" alt="Student Photo">
                </div>
                <!-- Card Back (Details) -->
                <div class="card-face card-back">
                    <h3 id="student-name" class="text-2xl font-bold text-gray-800 mb-2"></h3>
                    <p class="text-sm text-gray-500 mb-4" id="student-class"></p>
                    <div class="text-left w-full">
                        <strong class="text-gray-700">Fun Fact:</strong>
                        <p id="student-fun-fact" class="text-gray-600 mb-3"></p>
                        <strong id="experience-title" class="text-gray-700">Experience:</strong>
                        <p id="student-experience" class="text-gray-600"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="flex justify-between items-center mb-4">
        <button id="prev-btn" class="bg-blue-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-600 transition-colors">
            Previous
        </button>
        <p id="card-counter" class="text-gray-600 font-medium">0 / 0</p>
        <button id="next-btn" class="bg-blue-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-600 transition-colors">
            Next
        </button>
    </div>

    <!-- Delete Button -->
    <div class="w-full text-center mt-4">
        <button id="delete-btn" class="bg-red-500 text-white text-sm font-semibold py-2 px-6 rounded-lg hover:bg-red-600 transition-colors shadow">
            Delete Card
        </button>
    </div>
</div>

<script>
    // --- IMPORTANT: PASTE YOUR FIREBASE CONFIGURATION HERE ---
    const firebaseConfig = {
        apiKey: "AIzaSyD7jyL6ZehEBPXCvzhDI59rO-Gtry36bwk",
        authDomain: "student-flashcards.firebaseapp.com",
        projectId: "student-flashcards",
        storageBucket: "student-flashcards.appspot.com",
        messagingSenderId: "737854832974",
        appId: "1:737854832974:web:536a0574d8868bc84d1e1f"
    };

    // --- Name of your collection in Firestore ---
    const firestoreCollectionName = "artifacts/student-entry-app-2025/public";

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Global state
    let allStudents = [];
    let filteredStudents = [];
    let currentIndex = 0;

    // DOM Elements
    const periodFilter = document.getElementById('period-filter');
    const card = document.getElementById('card');
    const cardCounter = document.getElementById('card-counter');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const noStudentsMessage = document.getElementById('no-students-message');
    const flashcardArea = document.getElementById('flashcard-area');
    const cardContainer = document.querySelector('.card-container');

    // --- Fetch Students from Firestore ---
    async function fetchStudents() {
        try {
            const snapshot = await db.collection(firestoreCollectionName).orderBy("timestamp", "desc").get();
            allStudents = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            console.log(`Found ${allStudents.length} students in the database.`);
            filterAndDisplayStudents();
        } catch (error) {
            console.error("Error fetching students: ", error);
            noStudentsMessage.textContent = "Error loading students. Check console.";
            noStudentsMessage.classList.remove('hidden');
            cardContainer.classList.add('hidden');
        }
    }

    // --- Filter and Display Logic ---
    function filterAndDisplayStudents() {
        const selectedPeriod = periodFilter.value;
        if (selectedPeriod === 'All') {
            filteredStudents = [...allStudents];
        } else {
            filteredStudents = allStudents.filter(student => student.period === selectedPeriod);
        }
        
        currentIndex = 0;
        updateDisplay();
    }
    
    // --- Update UI ---
    function updateDisplay() {
        // Un-flip the card for the new student
        if (card.classList.contains('is-flipped')) {
            card.classList.remove('is-flipped');
        }

        if (filteredStudents.length === 0) {
            noStudentsMessage.classList.remove('hidden');
            cardContainer.classList.add('hidden');
            cardCounter.textContent = '0 / 0';
            return;
        }

        noStudentsMessage.classList.add('hidden');
        cardContainer.classList.remove('hidden');

        const student = filteredStudents[currentIndex];
        
        // Update card content
        document.getElementById('student-photo').src = student.photo;
        document.getElementById('student-name').textContent = student.preferredName || student.givenName;
        document.getElementById('student-class').textContent = `Period ${student.period} - ${student.className}`;
        document.getElementById('student-fun-fact').textContent = student.funFact;
        document.getElementById('student-experience').textContent = student.experience;

        // Update experience title
        const experienceTitle = document.getElementById('experience-title');
        if (student.className === 'Computer Programming') {
            experienceTitle.textContent = "Programming Experience:";
        } else {
            experienceTitle.textContent = "Math Experience:";
        }

        // Update counter
        cardCounter.textContent = `${currentIndex + 1} / ${filteredStudents.length}`;
    }

    // --- Event Listeners ---
    periodFilter.addEventListener('change', filterAndDisplayStudents);
    card.addEventListener('click', () => card.classList.toggle('is-flipped'));

    nextBtn.addEventListener('click', () => {
        if (filteredStudents.length > 0) {
            currentIndex = (currentIndex + 1) % filteredStudents.length;
            updateDisplay();
        }
    });

    prevBtn.addEventListener('click', () => {
        if (filteredStudents.length > 0) {
            currentIndex = (currentIndex - 1 + filteredStudents.length) % filteredStudents.length;
            updateDisplay();
        }
    });

    // Wire the delete button (after the DOM loads)
    document.getElementById('delete-btn').addEventListener('click', deleteCurrentCard);

    async function deleteCurrentCard() {
        if (filteredStudents.length === 0) return;

        const student = filteredStudents[currentIndex];
        const displayName = student.preferredName || student.givenName || 'this student';

        const ok = window.confirm(`Delete ${displayName}'s card? This cannot be undone.`);
        if (!ok) return;

        try {
            // Delete from Firestore
            await db.collection(firestoreCollectionName).doc(student.id).delete();

            // Remove from local arrays
            const id = student.id;
            allStudents = allStudents.filter(s => s.id !== id);
            filteredStudents = filteredStudents.filter(s => s.id !== id);

            // Adjust index if necessary
            if (currentIndex >= filteredStudents.length) currentIndex = 0;

            // Refresh UI
            updateDisplay();
        } catch (err) {
            console.error('Error deleting card:', err);
            alert('Sorry, the delete failed. Check console for details.');
        }
    }

    // --- Initial Load ---
    fetchStudents();
</script>
</body>
</html>
